{% extends 'base.html' %}

{% block title %}{{ room }} — Tables{% endblock %}

{% block content %}

<style>
  /* Card styling that adapts to theme */
  .tables-card { border-radius:14px; padding:14px; border:1px solid; }
  body.dark-mode .tables-card { background:#111827; color:#e5e7eb; border-color:#2b2f36; }
  body:not(.dark-mode) .tables-card { background:#f3f4f6; color:#111827; border-color:#d1d5db; }

  /* Meta rows: clearer in light mode, softer in dark */
  .tables-card .meta { font-size:14px; margin-top:2px; }
  body.dark-mode .tables-card .meta { color:#cbd5e1; }
  body:not(.dark-mode) .tables-card .meta { color:#374151; }

  /* Left panel layout so Back can stick to bottom-left */
  .tables-aside { position:relative; padding-bottom:72px; }

  /* Minimal rectangular Back button pinned bottom-left */
  .back-btn {
    position:absolute; left:16px; bottom:16px;
    display:inline-flex; align-items:center; gap:6px;
    padding:8px 12px; border-radius:8px; text-decoration:none; font-size:14px;
    border:1px solid; box-shadow:0 1px 2px rgba(0,0,0,.08);
  }
  body.dark-mode .back-btn { background:#0b1220; color:#e5e7eb; border-color:#2b2f36; }
  body:not(.dark-mode) .back-btn { background:#eef2f7; color:#111827; border-color:#cbd5e1; }

  /* Left-panel title/subtitle contrast for dark mode */
  .tables-title { margin-top:16px; }
  .tables-subtitle { margin:6px 0 14px 0; font-size:14px; }
  body.dark-mode .tables-title { color:#e5e7eb; }
  body.dark-mode .tables-subtitle { color:#cbd5e1; }
  body:not(.dark-mode) .tables-title { color:#111827; }
  body:not(.dark-mode) .tables-subtitle { color:#374151; }
</style>



<div class="main-grid">
  <!-- Left panel -->
  <aside class="game-panel tables-aside">
    

    <h2 class="tables-title">{{ room }} — Tables</h2>
    <p class="tables-subtitle">Welcome, {{ username }}! Choose an action below.</p>


    <!-- Action buttons -->
    <div style="display:flex;flex-direction:column;gap:10px;margin-top:20px;">
      <button onclick="createTable()" 
              style="padding:10px;border-radius:10px;border:none;background:#2563eb;color:white;cursor:pointer;">
        ➕ Create Table
      </button>

      <button onclick="joinRandomTable()" 
              style="padding:10px;border-radius:10px;border:none;background:#10b981;color:white;cursor:pointer;">
        🎲 Join Random Table
      </button>
    </div>

<a href="{{ url_for('chat') }}" style="display:inline-flex;align-items:center;gap:8px;">
  ⬅ Back
</a>

  </aside>

  <!-- Right panel: tables list -->
  <section class="chat-panel" style="padding:16px;">
    <h3 style="margin-bottom:14px;">Available Tables</h3>
    <div id="tables-list" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;">
      {% for t in tables %}
      <div class="tables-card">
        <div style="font-weight:600;margin-bottom:6px;">{{ t.name }}</div>
        <div class="meta">Players: {{ t.players }}</div>
        <div class="meta">Status: {{ t.status }}</div>
        <div style="margin-top:10px;">
          <a href="{{ url_for('game_room', room_name=room) }}?table={{ t.id }}" 
             class="game-tile" 
             style="padding:6px 10px;border-radius:10px;text-decoration:none;">
             Join
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>
</div>

<script>
function createTable() {
  alert("🛠️ Create Table feature coming soon!");
}

function joinRandomTable() {
  const tables = {{ tables|tojson }};
  const openTables = tables.filter(t => t.status === "Open");
  if (openTables.length > 0) {
    const random = openTables[Math.floor(Math.random() * openTables.length)];
    window.location.href = `/game/{{ room }}?table=${random.id}`;
  } else {
    alert("😕 No open tables available right now.");
  }
}
</script>

<a href="{{ url_for('chat') }}" class="back-btn">⬅ Back</a>

{% endblock %}
